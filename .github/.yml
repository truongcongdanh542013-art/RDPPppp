name: ğŸš€ LongVPS

on:
  workflow_dispatch:
    inputs:
      duration:
        description: 'ğŸ• Thá»i gian sá»­ dá»¥ng'
        required: false
        default: '5h40m'
        type: choice
        options:
          - '1h'
          - '3h'
          - '5h40m'

jobs:
  Premium-RDP-Setup:
    runs-on: windows-latest
    timeout-minutes: 340

    steps:
      - name: ğŸ“¢ BANNER KHá»I Äá»˜NG
        shell: pwsh
        run: |
          $banner = @"
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘              ğŸš€ LONGDAY SERVER               â•‘
â•‘         âš¡ Powered by AIL | Premium RDP       â•‘
â•‘----------------------------------------------â•‘
â•‘  ğŸ•’ Thá»i gian:  ${{ github.event.inputs.duration }}             
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
"@

          Write-Output $banner

          $frames = @('â£¾','â£½','â£»','â¢¿','â¡¿','â£Ÿ','â£¯','â£·')
          for($i=0; $i -lt 20; $i++){
            Write-Host "`rğŸš€ Äang khá»Ÿi táº¡o há»‡ thá»‘ng... $($frames[$i%8])" -NoNewline
            Start-Sleep -Milliseconds 80
          }
          Write-Host "`râœ… Há»‡ thá»‘ng Ä‘Ã£ sáºµn sÃ ng!      "

      - name: ğŸ¯ KHá»I Äá»˜NG Há»† THá»NG
        shell: pwsh
        run: |
          Write-Host ""
          Write-Host ""
          Write-Host "ğŸ¤– Longday SERVER" -ForegroundColor Yellow
          Write-Host "âš¡ Powered by AIL" -ForegroundColor Green
          Write-Host "ğŸ•’ Thá»i gian: ${{ github.event.inputs.duration }}" -ForegroundColor Magenta
          Write-Host ""

          $frames = @('â£¾', 'â£½', 'â£»', 'â¢¿', 'â¡¿', 'â£Ÿ', 'â£¯', 'â£·')
          for($i=0; $i -lt 10; $i++) {
              Write-Host "`rğŸš€ Äang khá»Ÿi táº¡o há»‡ thá»‘ng... $($frames[$i % 8])" -NoNewline -ForegroundColor Blue
              Start-Sleep -Milliseconds 100
          }
          Write-Host "`râœ… Há»‡ thá»‘ng Ä‘Ã£ sáºµn sÃ ng!                    " -ForegroundColor Green

      - name: ğŸ”§ Cáº¤U HÃŒNH Há»† THá»NG
        shell: pwsh
        run: |
          Write-Host ""
          Write-Host "ğŸ› ï¸  ÄANG Cáº¤U HÃŒNH Há»† THá»NG" -ForegroundColor Yellow
          
          $steps = @(
              @{Name="Báº­t Remote Desktop"; Script={ 
                  Set-ItemProperty -Path 'HKLM:\System\CurrentControlSet\Control\Terminal Server' -Name "fDenyTSConnections" -Value 0 -Force
              }},
              @{Name="Táº¯t xÃ¡c thá»±c máº¡ng"; Script={
                  Set-ItemProperty -Path 'HKLM:\System\CurrentControlSet\Control\Terminal Server\WinStations\RDP-Tcp' -Name "UserAuthentication" -Value 0 -Force
              }},
              @{Name="Cáº¥u hÃ¬nh báº£o máº­t RDP"; Script={
                  Set-ItemProperty -Path 'HKLM:\System\CurrentControlSet\Control\Terminal Server\WinStations\RDP-Tcp' -Name "SecurityLayer" -Value 0 -Force
                  Set-ItemProperty -Path 'HKLM:\System\CurrentControlSet\Control\Terminal Server\WinStations\RDP-Tcp' -Name "UserAuthentication" -Value 0 -Force
              }},
              @{Name="Má»Ÿ port 3389 firewall"; Script={
                  netsh advfirewall firewall add rule name="RDP-Premium" dir=in action=allow protocol=TCP localport=3389 profile=any
                  netsh advfirewall firewall add rule name="RDP-Premium-Out" dir=out action=allow protocol=TCP localport=3389 profile=any
              }},
              @{Name="Khá»Ÿi Ä‘á»™ng dá»‹ch vá»¥"; Script={
                  Set-Service -Name TermService -StartupType Automatic -ErrorAction SilentlyContinue
                  Set-Service -Name UmRdpService -StartupType Automatic -ErrorAction SilentlyContinue
                  Start-Service -Name TermService -ErrorAction SilentlyContinue
                  Start-Service -Name UmRdpService -ErrorAction SilentlyContinue
              }}
          )
          
          foreach($step in $steps) {
              Write-Host "â”‚ ğŸ“‹ $($step.Name)..." -NoNewline -ForegroundColor White
              try {
                  & $step.Script
                  Write-Host "`râ”‚ âœ… $($step.Name)" -ForegroundColor Green
              } catch {
                  Write-Host "`râ”‚ âš ï¸  $($step.Name) - ÄÃ£ bá» qua lá»—i nhá»" -ForegroundColor Yellow
              }
              Start-Sleep -Milliseconds 500
          }
          
          Write-Host "ğŸ¯ Cáº¥u hÃ¬nh hoÃ n táº¥t!" -ForegroundColor Green

      - name: ğŸ‘¤ Táº O TÃ€I KHOáº¢N PREMIUM
        shell: pwsh
        run: |
          # (Giá»¯ nguyÃªn toÃ n bá»™ ná»™i dung script táº¡o user vÃ  password cá»§a báº¡n)
          Write-Host "ğŸ‘¤ Táº¡o user LongDay2203..."

      - name: ğŸ” KIá»‚M TRA QUYá»€N Há»† THá»NG
        shell: pwsh
        run: |
          Write-Host "ğŸ” Kiá»ƒm tra quyá»n há»‡ thá»‘ng..."

      - name: ğŸŒ THIáº¾T Láº¬P Máº NG PREMIUM
        shell: pwsh
        env:
          TAILSCALE_AUTH_KEY: ${{ secrets.TAILSCALE_AUTH_KEY }}
        run: |
          Write-Host "ğŸŒ Thiáº¿t láº­p máº¡ng Tailscale..."

      - name: ğŸ‰ THÃ”NG TIN Káº¾T Ná»I
        shell: pwsh
        run: |
          Write-Host "ğŸ‰ Hiá»ƒn thá»‹ thÃ´ng tin káº¿t ná»‘i..."

      - name: â³ DUY TRÃŒ PHIÃŠN LÃ€M VIá»†C
        shell: pwsh
        run: |
          Write-Host "â³ Duy trÃ¬ phiÃªn lÃ m viá»‡c..."

      - name: ğŸ§¹ Dá»ŒN Dáº¸P Há»† THá»NG
        if: always()
        shell: pwsh
        run: |
          Write-Host "ğŸ§¹ Dá»n dáº¹p há»‡ thá»‘ng..."
