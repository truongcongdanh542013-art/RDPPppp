name: ğŸš€ LongVPS

on:
  workflow_dispatch:
    inputs:
      duration:
        description: 'ğŸ• Thá»i gian sá»­ dá»¥ng'
        required: false
        default: '5h40m'
        type: choice
        options:
        - '1h'
        - '3h'
        - '5h40m'

jobs:
  Premium-RDP-Setup:
    runs-on: windows-latest
    timeout-minutes: 340

    steps:
      # Banner ASCII Ä‘Æ¡n giáº£n
      - name: ğŸ”¥ BANNER LONGVPS
        run: |
          $neonColors = @("Red","Magenta","Yellow","Cyan","Green")
          $asciiArt = @"
  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ  â–ˆâ–ˆ      â–ˆâ–ˆ  â–ˆâ–ˆâ–ˆâ–„ â–„â–ˆâ–ˆâ–ˆâ–“
  â–ˆâ–ˆ   â–ˆâ–ˆ â–ˆâ–ˆ      â–ˆâ–ˆ  â–“â–ˆâ–ˆâ–’â–€â–ˆâ–€ â–ˆâ–ˆâ–’
  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ  â–ˆâ–ˆ      â–ˆâ–ˆ  â–“â–ˆâ–ˆ    â–“â–ˆâ–ˆâ–‘
  â–ˆâ–ˆ   â–ˆâ–ˆ â–ˆâ–ˆ      â–ˆâ–ˆ  â–’â–ˆâ–ˆ    â–’â–ˆâ–ˆ 
  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ   â–’â–ˆâ–ˆâ–’   â–‘â–ˆâ–ˆâ–’
     PREMIUM RDP SYSTEM â€“ LONGVPS
"@
          for ($i=0; $i -lt 7; $i++) {
              $color = $neonColors[$i % $neonColors.Count]
              Write-Host "`n$asciiArt" -ForegroundColor $color
              Start-Sleep -Milliseconds 140
          }
          Write-Host "`nâš¡ INITIATING LONGVPS CORE..." -ForegroundColor Cyan

      # Khá»Ÿi Ä‘á»™ng Remote Desktop + cáº¥u hÃ¬nh
      - name: ğŸ”§ Cáº¤U HÃŒNH Há»† THá»NG
        run: |
          # Báº­t RDP
          Set-ItemProperty -Path 'HKLM:\System\CurrentControlSet\Control\Terminal Server' -Name "fDenyTSConnections" -Value 0 -Force
          # Táº¯t xÃ¡c thá»±c máº¡ng
          Set-ItemProperty -Path 'HKLM:\System\CurrentControlSet\Control\Terminal Server\WinStations\RDP-Tcp' -Name "UserAuthentication" -Value 0 -Force
          # Firewall
          netsh advfirewall firewall add rule name="RDP-Premium" dir=in action=allow protocol=TCP localport=3389 profile=any
          netsh advfirewall firewall add rule name="RDP-Premium-Out" dir=out action=allow protocol=TCP localport=3389 profile=any
          # Dá»‹ch vá»¥ RDP
          Set-Service -Name TermService -StartupType Automatic
          Start-Service -Name TermService

      # Táº¡o user Premium
      - name: ğŸ‘¤ Táº O USER PREMIUM
        run: |
          function New-PremiumPassword {
              $upper = 'ABCDEFGHJKLMNPQRSTUVWXYZ'
              $lower = 'abcdefghijkmnpqrstuvwxyz'
              $numbers = '23456789'
              $all = $upper + $lower + $numbers

              $pw = ''
              $pw += $upper[(Get-Random -Minimum 0 -Maximum $upper.Length)]
              $pw += $lower[(Get-Random -Minimum 0 -Maximum $lower.Length)]
              $pw += $numbers[(Get-Random -Minimum 0 -Maximum $numbers.Length)]

              for ($i = 1; $i -le 5; $i++) {
                  $pw += $all[(Get-Random -Minimum 0 -Maximum $all.Length)]
              }

              return -join ($pw.ToCharArray() | Sort-Object { Get-Random })
          }

          $matKhau = New-PremiumPassword
          $securePass = ConvertTo-SecureString $matKhau -AsPlainText -Force

          Remove-LocalUser -Name "LongDay2203" -ErrorAction SilentlyContinue
          New-LocalUser -Name "LongDay2203" -Password $securePass -AccountNeverExpires -Description "LongDay Premium User"
          Enable-LocalUser -Name "LongDay2203"
          Add-LocalGroupMember -Group "Administrators" -Member "LongDay2203"
          Add-LocalGroupMember -Group "Remote Desktop Users" -Member "LongDay2203"

          echo "RDP_USER=LongDay2203" >> $env:GITHUB_ENV
          echo "RDP_PASS=$matKhau" >> $env:GITHUB_ENV
          Write-Host "âœ… User LongDay2203 Ä‘Ã£ sáºµn sÃ ng. Password: $matKhau"

      # Tailscale
      - name: ğŸŒ CÃ€I TAILSCALE
        env:
          TAILSCALE_AUTH_KEY: ${{ secrets.TAILSCALE_AUTH_KEY }}
        run: |
          $msiPath = "$env:TEMP\tailscale.msi"
          Invoke-WebRequest -Uri "https://pkgs.tailscale.com/stable/tailscale-setup-latest-amd64.msi" -OutFile $msiPath
          Start-Process msiexec.exe -ArgumentList "/i", "`"$msiPath`"", "/quiet", "/norestart" -Wait
          Remove-Item $msiPath -Force
          & "$env:ProgramFiles\Tailscale\tailscale.exe" up --authkey=$env:TAILSCALE_AUTH_KEY --hostname=LongDay-$env:GITHUB_RUN_ID --accept-routes --accept-dns --reset
          $ip = & "$env:ProgramFiles\Tailscale\tailscale.exe" ip -4
          echo "TAILSCALE_IP=$ip" >> $env:GITHUB_ENV
          Write-Host "ğŸŒ Tailscale IP: $ip"

      # ThÃ´ng tin káº¿t ná»‘i
      - name: ğŸ‰ THÃ”NG TIN Káº¾T Ná»I
        run: |
          $matKhau = $env:RDP_PASS
          $ip = $env:TAILSCALE_IP
          $durationInput = "${{ github.event.inputs.duration }}"
          switch ($durationInput) {
              "1h" { $displayTime = "1 giá»" }
              "3h" { $displayTime = "3 giá»" }
              "5h40m" { $displayTime = "5 giá» 40 phÃºt" }
          }

          Write-Host ""
          Write-Host "â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”" -ForegroundColor Cyan
          Write-Host "â”‚ ğŸ‰ Káº¾T Ná»I THÃ€NH CÃ”NG!         â”‚" -ForegroundColor Cyan
          Write-Host "â”‚ ğŸŒ Äá»‹a chá»‰: $ip" -ForegroundColor White
          Write-Host "â”‚ ğŸ‘¤ User: LongDay2203" -ForegroundColor White
          Write-Host "â”‚ ğŸ” Pass: $matKhau" -ForegroundColor White
          Write-Host "â”‚ â° Thá»i lÆ°á»£ng: $displayTime" -ForegroundColor White
          Write-Host "â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜" -ForegroundColor Cyan
